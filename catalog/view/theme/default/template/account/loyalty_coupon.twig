{{ header }}
<div id="account-reward" class="container">

  <ul class="breadcrumb">
    {% for breadcrumb in breadcrumbs %}
      <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
    {% endfor %}
  </ul>

  <div class="row">
    {{ column_left }}

    {% if column_left and column_right %}
      {% set class = 'col-sm-6' %}
    {% elseif column_left or column_right %}
      {% set class = 'col-sm-9' %}
    {% else %}
      {% set class = 'col-sm-12' %}
    {% endif %}

    <div id="content" class="{{ class }}">
      {{ content_top }}

      <h1>{{ heading_title }}</h1>

      <!-- Баланс -->
      <div class="well text-center" style="background:#fdfdfd;border:2px solid #e9ecef;border-radius:10px;padding:20px;margin-bottom:30px;">
        <p style="margin-bottom:5px;text-transform:uppercase;letter-spacing:1px;color:#666;">
          Вашият баланс в момента
        </p>
        <div style="font-size:48px;font-weight:bold;color:#2c3e50;line-height:1;">
          <i class="fa fa-star" style="color:#f1c40f;"></i>
          {{ total }}
          <span style="font-size:18px;color:#95a5a6;font-weight:normal;">точки</span>
        </div>
      </div>

      <!-- Купони -->
      <div class="row" style="margin-bottom:40px;">
        <div class="col-sm-12">
          <h3 class="text-center" style="margin-bottom:25px;">
            Размени своите точки за отстъпка
          </h3>

          <div class="row">

            <!-- Купон 5 лв -->
            <div class="col-sm-6">
              <div class="panel panel-default text-center">
                <div class="panel-body" style="padding:30px;">
                  <div style="font-size:24px;font-weight:bold;margin-bottom:10px;">
                    Купон за 5.00 лв.
                  </div>
                  <div style="font-size:14px;color:#e74c3c;margin-bottom:20px;">
                    <i class="fa fa-minus-circle"></i> струва 10 точки
                  </div>

                  <button type="button"
                          class="btn btn-primary btn-block btn-lg buy-coupon"
                          data-points="10"
                          data-amount="5"
                          {% if total < 10 %}disabled{% endif %}
                          style="border-radius:25px;">
                    {% if total < 10 %}Недостъпно{% else %}Вземи купон{% endif %}
                  </button>
                </div>
              </div>
            </div>

            <!-- Купон 10 лв -->
            <div class="col-sm-6">
              <div class="panel panel-default text-center">
                <div class="panel-body" style="padding:30px;">
                  <div style="font-size:24px;font-weight:bold;margin-bottom:10px;">
                    Купон за 10.00 лв.
                  </div>
                  <div style="font-size:14px;color:#e74c3c;margin-bottom:20px;">
                    <i class="fa fa-minus-circle"></i> струва 50 точки
                  </div>

                  <button type="button"
                          class="btn btn-primary btn-block btn-lg buy-coupon"
                          data-points="50"
                          data-amount="10"
                          {% if total < 50 %}disabled{% endif %}
                          style="border-radius:25px;">
                    {% if total < 50 %}Недостъпно{% else %}Вземи купон{% endif %}
                  </button>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- История -->
      <h3>История на купоните</h3>

      <div class="table-responsive">
        <table class="table table-bordered table-hover">
          <thead>
            <tr>
              <td class="text-left">{{ column_date_added }}</td>
              <td class="text-left">{{ column_code }}</td>
              <td class="text-right">{{ column_points_spent }}</td>
              <td class="text-right">{{ column_amount }}</td>
              <td class="text-right">{{ column_status }}</td>
            </tr>
          </thead>
          <tbody>
            {% if coupons %}
              {% for coupon in coupons %}
                <tr>
                  <td class="text-left">{{ coupon.date_added }}</td>
                  <td class="text-left">{{ coupon.code }}</td>
                  <td class="text-right">{{ coupon.points_spent }}</td>
                  <td class="text-right">
                    <span style="font-weight:bold;">
                      {{ coupon.amount }}
                    </span>
                  </td>
                  <td class="text-right">
                    {% if coupon.status == '1' %}
                      <span class="label label-success">Активен</span>
                    {% else %}
                      <span class="label label-danger">Използван</span>
                    {% endif %}
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="4" class="text-center">{{ text_empty }}</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>

      <div class="row">
        <div class="col-sm-6 text-left">{{ pagination }}</div>
        <div class="col-sm-6 text-right">{{ results }}</div>
      </div>

      <div class="buttons clearfix">
        <div class="pull-right">
          <a href="{{ continue }}" class="btn btn-default">
            {{ button_continue }}
          </a>
        </div>
      </div>

      {{ content_bottom }}
    </div>

    {{ column_right }}
  </div>
</div>

<script type="text/javascript">
$('.buy-coupon').on('click', function () {

    var button = $(this);
    var points = button.data('points');
    var amount = button.data('amount');

    button.prop('disabled', true);

    $.ajax({
        url: 'index.php?route=account/loyalty_coupon/generateCoupon',
        type: 'post',
        data: {
            points: points,
            amount: amount
        },
        dataType: 'json',
        success: function (json) {

            if (json.success) {
                alert(json.success);
                location.reload();
            }

            if (json.error) {
                alert(json.error);
                button.prop('disabled', false);
            }
        },
        error: function (xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\n" + xhr.statusText + "\n" + xhr.responseText);
            button.prop('disabled', false);
        }
    });

});
</script>

{{ footer }}